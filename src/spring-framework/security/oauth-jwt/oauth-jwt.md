#### [Введение](#Введение-1)
#### [Теоретическая база](#Теоретическая-база-1)
#### [Практическая часть](#Практическая-часть-1)
#### [Типичные ошибки и решения](#Типичные-ошибки-и-решения-1)
#### [Рекомендации и Best Practices](#Рекомендации-и-best-practices-1)
#### [Дополнительные материалы](#Дополнительные-материалы-1)
#### [Заключение](#Заключение-1)

---

## Введение

#### 1.1. Зачем это нужно?
OAuth2 и JWT являются ключевыми технологиями для реализации безопасной аутентификации и авторизации в современных приложениях. Они позволяют управлять доступом к ресурсам, защищать данные пользователей и обеспечивать взаимодействие между микросервисами. Пример: крупные платформы, такие как Google и GitHub, используют OAuth2 для предоставления API клиентам.

#### 1.2. Базовые термины
- **OAuth2**: Протокол авторизации, позволяющий третьим сторонам получать ограниченный доступ к ресурсам пользователя без передачи пароля.
- **JWT (JSON Web Token)**: Стандартизированный формат токенов, используемых для передачи информации между сторонами. Он содержит заголовок, полезную нагрузку и подпись.

---

## Теоретическая база

#### 2.1. Основные концепции
OAuth2 работает через выдачу токенов, которые заменяют логин/пароль при запросах к защищенным ресурсам. Процесс включает:
1. Клиент запрашивает токен у провайдера авторизации.
2. Провайдер проверяет учетные данные и выдает токен.
3. Клиент использует токен для доступа к ресурсам.

JWT состоит из трех частей:
- **Header**: Метаданные о токене (алгоритм подписи).
- **Payload**: Данные пользователя (claims).
- **Signature**: Подпись для проверки целостности.

| Параметр | Описание |
|----------|----------|
| `iss`    | Идентификатор издателя токена. |
| `sub`    | Идентификатор субъекта (пользователя). |
| `exp`    | Время истечения токена. |

#### 2.2. Углубленные темы
**Сравнение OAuth2 и Basic Auth**:
- OAuth2 более безопасен, так как не передает пароли напрямую.
- Требует больше настроек, но обеспечивает гибкость.

**Архитектура системы с OAuth2**:
```
+-------------------+
|   Resource Owner  |
+-------------------+
          |
          v
+-------------------+
| Authorization     |
| Server            |
+-------------------+
          |
          v
+-------------------+
|   Client          |
+-------------------+
          |
          v
+-------------------+
|   Resource Server |
+-------------------+
```

#### 2.3. Теория в схемах
Блок-схема процесса авторизации:
```
[Клиент] --> [Авторизационный сервер] --> [Токен]
[Клиент] --> [Ресурсный сервер] --> [Доступ к данным]
```

---

## Практическая часть

#### 3.1. Базовые примеры
Настройка OAuth2 в Spring Security:
```java
@Configuration
public class OAuth2Config extends WebSecurityConfigurerAdapter {
    @Override
    protected void configure(HttpSecurity http) throws Exception {
        http.authorizeRequests()
            .antMatchers("/public/**").permitAll()
            .anyRequest().authenticated()
            .and()
            .oauth2Login();
    }
}
```

Генерация JWT:
```java
import io.jsonwebtoken.Jwts;
import io.jsonwebtoken.SignatureAlgorithm;

String jwt = Jwts.builder()
    .setSubject("user123")
    .claim("role", "admin")
    .signWith(SignatureAlgorithm.HS256, "secretKey")
    .compact();
```

#### 3.2. Реальные кейсы
Пример: Авторизация в микросервисной архитектуре.
1. Сервис A требует доступ к данным сервиса B.
2. Сервис A отправляет JWT в заголовке запроса.
3. Сервис B проверяет токен и обрабатывает запрос.

#### 3.3. Задачи для самопроверки
1. Настройте OAuth2 для защиты REST API.
2. Реализуйте механизм обновления токенов (`refresh token`).

---

## Типичные ошибки и решения

#### 4.1. Распространенные ошибки
- Неправильная настройка алгоритма подписи JWT.
- Отсутствие проверки времени истечения токена.
- Хранение секретных ключей в открытом доступе.

#### 4.2. Как их избежать?
- Используйте надежные библиотеки для работы с JWT.
- Храните секретные ключи в защищенном месте (например, AWS Secrets Manager).
- Регулярно обновляйте токены.

---

## Рекомендации и Best Practices

#### 5.1. Советы экспертов
- Используйте `https` для всех запросов, содержащих токены.
- Ограничьте время жизни токенов (`access token` и `refresh token`).
- Проверяйте подпись токена на каждом запросе.

#### 5.2. Инструменты и ресурсы
- **Spring Security**: Официальная документация.
- **JWT.io**: Инструмент для анализа и создания токенов.
- **Postman**: Для тестирования API с OAuth2.

---

## Дополнительные материалы

#### 6.1. Глоссарий
- **Scope**: Разрешения, предоставленные токену.
- **Bearer Token**: Тип токена, используемый в заголовках HTTP.

#### 6.2. Полезные ссылки
- [Spring Security Reference](https://docs.spring.io/spring-security/reference/)
- [RFC 6749 (OAuth2)](https://tools.ietf.org/html/rfc6749)

#### 6.3. Тесты/Опросы
1. Что такое `refresh token`?
    - А) Токен для обновления данных.
    - Б) Токен для получения нового `access token`.  
      *Ответ: Б.*

---

## Заключение

#### 7.1. Итоги
OAuth2 и JWT обеспечивают надежную защиту данных и удобное управление доступом. Правильная настройка этих технологий — ключевой момент в разработке безопасных приложений.

#### 7.2. Что дальше?
Изучите продвинутые возможности OAuth2, такие как OpenID Connect, и примените их в своих проектах.