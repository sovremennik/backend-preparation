#### [Введение](#Введение-1)
#### [Основные концепции](#Основные-концепции-1)
#### [Примеры конфигурации](#Примеры-конфигурации-1)
#### [Ошибки и решения](#Ошибки-и-решения-1)
#### [Best Practices](#best-practices-1)

---

## Введение
Gradle — мощный инструмент сборки, широко используемый в backend-разработке для управления зависимостями и автоматизации процессов CI/CD. Интеграция Gradle с GitLab CI позволяет создать гибкий и масштабируемый пайплайн, обеспечивая автоматическое тестирование, сборку и развертывание приложений. Это критически важно для проектов с высокой нагрузкой, где стабильность и скорость развертывания напрямую влияют на бизнес-метрики.

## Основные концепции
- **Gradle и автоматизация**: Gradle позволяет декларативно описывать процессы сборки, тестирования и деплоя.
- **GitLab CI/CD**: Инструмент GitLab для автоматизированного выполнения пайплайнов при коммитах и merge-запросах.
- **Кэширование зависимостей**: Использование Gradle Build Cache и артефактов GitLab ускоряет сборку и снижает нагрузку на CI/CD-сервер.
- **Параллельные задачи**: GitLab CI поддерживает параллельное выполнение job'ов, что снижает общее время пайплайна.
- **Автоматизация деплоя**: Интеграция с Kubernetes/Docker для автоматического развертывания после успешного тестирования.

## Примеры конфигурации

### 1. Базовый `.gitlab-ci.yml` для Gradle-проекта
```yaml
image: gradle:8.5-jdk17

cache:
  paths:
    - .gradle/wrapper
    - .gradle/caches

default:
  before_script:
    - gradle --version

test:
  stage: test
  script:
    - gradle test
  artifacts:
    paths:
      - build/reports/tests

build:
  stage: build
  script:
    - gradle build
  artifacts:
    paths:
      - build/libs/*.jar

deploy:
  stage: deploy
  script:
    - echo "Deploying application..."
```

### 2. Кеширование зависимостей и билдов
```yaml
cache:
  key: "$CI_COMMIT_REF_NAME"
  paths:
    - .gradle/caches
    - .gradle/wrapper
```

### 3. Запуск тестов с параллелизацией
```yaml
test:
  stage: test
  parallel: 4
  script:
    - gradle test
```

## Ошибки и решения

| Ошибка | Причина | Решение |
|--------|--------|---------|
| `OutOfMemoryError` при билде | Недостаточно памяти для Gradle Daemon | Увеличить `GRADLE_OPTS: "-Xmx2g"` |
| Долгая сборка | Отсутствует кеширование зависимостей | Добавить `cache.paths` в `.gitlab-ci.yml` |
| Ошибка доступа к артефактам | Артефакты недоступны в последующих job'ах | Убедиться, что артефакты объявлены в `artifacts.paths` |

## Best Practices
1. **Используй Gradle Build Cache**: Снижает время сборки за счёт кеширования неизменных задач.
2. **Храни артефакты между job'ами**: Передавай скомпилированные `.jar` или `.war` файлы в `artifacts.paths`.
3. **Разделяй окружения**: Создавай отдельные `staging` и `production` job'ы.
4. **Используй `parallel:` для тестов**: Ускоряет выполнение unit-тестов.
5. **Логируй важные метрики**: Выводи в пайплайн статистику по тестам и сборке.

