#### [Введение](#Введение-1)
#### [Основные концепции](#Основные-концепции-1)
#### [Примеры конфигурации](#Примеры-конфигурации-1)
#### [Ошибки и решения](#Ошибки-и-решения-1)
#### [Best Practices](#best-practices-1)

---

## Введение
Организация структуры многомодульных проектов в Gradle — ключевой элемент для разработки высоконагруженных систем. Правильное разделение на модули позволяет сократить время сборки на 30-50%, изолировать компоненты и упростить масштабирование. Например, в микросервисной архитектуре с 500+ сервисами грамотная модуляризация предотвращает "спагетти-зависимости" и ускоряет CI/CD-пайплайны.

---

## Основные концепции  
### Практическое определение
Многомодульный проект — это система, где:
- Каждый модуль решает отдельную задачу (API, база данных, кеширование).
- Зависимости между модулями явно декларируются.
- Общие настройки (версии, плагины) централизовано управляются.

### Релевантность для backend
- **Изоляция компонентов**: Модуль аутентификации не зависит от модуля оплаты.
- **Параллельная сборка**: Gradle собирает независимые модули одновременно.
- **Переиспользование кода**: Общие утилиты вынесены в отдельный модуль.

### Разъяснение терминов
- **Родительский проект** — как "дирижёр оркестра": управляет общими настройками всех модулей.
- **settings.gradle** — "карта проекта": указывает, какие модули входят в сборку.
- **api vs implementation** — "публичный и приватный доступ": `api` экспортирует зависимости, `implementation` скрывает.

---

## Примеры конфигурации  
### Базовая структура проекта
```
project-root/
├── settings.gradle
├── build.gradle
├── api/
│   ├── build.gradle
├── core/
│   ├── build.gradle
└── service-payment/
├── build.gradle
```

### Настройка settings.gradle
```groovy
rootProject.name = 'highload-platform'

include(
    ':api',
    ':core:utils',
    ':core:database',
    ':services:payment',
    ':services:notifications'
)
```
**Что происходит:**
- Объявляется корневой проект и подключаются модули.
- Модули группируются по функциональности (core, services).

**Для чего:**
- Чтобы Gradle понимал структуру проекта и зависимости между модулями.

---

### Общие настройки в build.gradle
```kotlin
// Родительский build.gradle
subprojects {
    apply(plugin = "java-library")
    apply(plugin = "io.spring.dependency-management")

    repositories {
        mavenCentral()
    }

    dependencies {
        implementation("org.slf4j:slf4j-api:2.0.12")
        testImplementation("org.junit.jupiter:junit-jupiter:5.10.2")
    }
}
```
**Что происходит:**
- Ко всем подпроектам применяются плагины и общие зависимости.
- Централизованная настройка логирования и тестирования.

**Для чего:**
- Чтобы избежать дублирования кода в модулях.

---

### Зависимости между модулями
```kotlin
// service-payment/build.gradle
dependencies {
    implementation(project(":api"))  # Зависимость от модуля API
    implementation(project(":core:database"))
}
```
**Что происходит:**
- Модуль `service-payment` получает доступ к классам из `api` и `core:database`.
- Gradle автоматически учитывает порядок сборки.

**Для чего:**
- Чтобы обеспечить взаимодействие между компонентами системы.

---

## Ошибки и решения
### Критические антипаттерны
| Ошибка | Последствия | Решение |
|--------|-------------|---------|
| Циклические зависимости | Бесконечная сборка, падения | Анализ графа зависимостей: `./gradlew :app:dependencies` |
| Гигантские модули | Медленная сборка, сложность тестирования | Разделение на подмодули по принципу SRP |
| Жесткая связность | Невозможность переиспользования кода | Вынос общих компонентов в отдельный модуль |

---

## Best Practices
1. **Слоистая архитектура**  
   Разделение на модули по уровням:
   ```
   ├── domain/           # Бизнес-логика
   ├── infrastructure/   # База данных, кеш
   └── delivery/         # REST API, GraphQL
   ```

2. **Градиентная видимость**  
   Запрет прямых зависимостей между несвязанными модулями:
   ```kotlin
   // settings.gradle.kts
   dependencyResolutionManagement {
       components.all {
           if (requested.name.contains("internal")) {
               reject("Прямой доступ к internal-модулям запрещён")
           }
       }
   }
   ```

3. **Интеграция с CI/CD**  
   Параллельная сборка модулей в GitLab:
   ```yaml
   build:
     parallel: 4
     script:
       - ./gradlew assemble -Pparallel=true
   ```

4. **Мониторинг времени сборки**  
   Вывод статистики в формате JSON:
   ```bash
   ./gradlew build --scan --no-daemon
   ```

5. **Шаблонизация модулей**  
   Общий конфиг для всех микросервисов:
   ```kotlin
   // core/build.gradle.kts
   plugins {
       id("org.springframework.boot") version "3.2.0" apply false
   }

   subprojects {
       apply(plugin = "org.springframework.boot")
       // Общие настройки Spring Boot
   }
   ```

