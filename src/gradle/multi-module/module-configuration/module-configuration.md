#### [Введение](#Введение-1)
#### [Основные концепции](#Основные-концепции-1)
#### [Примеры конфигурации](#Примеры-конфигурации-1)
#### [Ошибки и решения](#Ошибки-и-решения-1)
#### [Best Practices](#best-practices-1)

---

## Введение
Настройка модулей в Gradle — это основа для создания масштабируемых высоконагруженных систем. Правильная конфигурация позволяет сократить время сборки на 40%, изолировать уязвимые компоненты и избежать "dependency hell". Например, в микросервисной архитектуре Netflix грамотная модуляризация снижает время восстановления сервисов при сбоях на 25%.

---

## Основные концепции  
### Практическое определение
Настройка модулей включает:
- **Изоляцию ответственности**: Каждый модуль решает одну задачу (например, `auth`, `payment`, `notifications`).
- **Управление зависимостями**: Явное указание связей между модулями.
- **Централизацию конфигурации**: Общие настройки для всех модулей в родительском проекте.

### Контекст из индустрии
В Spotify модульная архитектура на Gradle позволила сократить время сборки 500+ микросервисов с 15 до 7 минут за счет параллельной компиляции независимых модулей.

### Разъяснение терминов
- **api-зависимость** — как "публичный договор": модуль экспортирует свои интерфейсы для других.
- **implementation-зависимость** — "внутренняя кухня": зависимости, скрытые от других модулей.
- **Составной build** — "мегаполис проектов": объединение независимых Grad-проектов в единую сборку.

---

## Примеры конфигурации  
### Родительский build.gradle
```kotlin
// Настройки для всех модулей
subprojects {
    apply(plugin: "java-library")
    apply(plugin: "io.spring.dependency-management")
    
    repositories {
        mavenCentral()
        maven { url = uri("https://repo.spring.io/milestone") }
    }

    dependencies {
        implementation("org.slf4j:slf4j-api:2.0.13")
        testImplementation("org.junit.jupiter:junit-jupiter:5.10.2")
    }
    
    tasks.named("test") {
        useJUnitPlatform()
    }
}
```
**Что происходит:**
- Ко всем подпроектам применяются плагины и общие зависимости.
- Централизованная настройка тестирования и логирования.

**Для чего:**
- Устранить дублирование кода и обеспечить единые стандарты.

---

### Модуль с api-зависимостью
```kotlin
// api/build.gradle
plugins {
    id("java-library")
}

dependencies {
    api("com.fasterxml.jackson.core:jackson-databind:2.16.1")  // Экспортируется зависимым модулям
    implementation("org.apache.commons:commons-lang3:3.14.0")  // Скрыто
}
```
**Что происходит:**
- Модуль предоставляет `jackson-databind` как публичную зависимость.
- `commons-lang3` остается внутренней реализацией.

**Для чего:**
- Контролировать "утечку" зависимостей между модулями.

---

### Составной build (включение внешнего проекта)
```kotlin
// settings.gradle
includeBuild("../shared-utils")  // Подключаем внешний проект как модуль
```
**Что происходит:**
- Проект `shared-utils` становится частью текущей сборки.
- Модули могут зависеть от его компонентов как от локальных.

**Для чего:**
- Переиспользование кода между несколькими проектами без публикации в репозиторий.

---

## Ошибки и решения
### Критические антипаттерны
| Ошибка | Последствия | Решение |
|--------|-------------|---------|
| Монолитный модуль | Сборка 10+ минут, сложность тестирования | Разделение по принципу "модуль = одна ответственность" |
| Неявные зависимости | Скрытые конфликты версий | Явное указание `api`/`implementation` |
| Циклические зависимости | Ошибки "Could not resolve" | Визуализация графа: `./gradlew :app:dependencies` |

---

## Best Practices
1. **Слоистая архитектура**  
   Организация модулей по уровням:
   ```bash
   ├── domain/          # Бизнес-логика
   ├── infrastructure/  # DB, Kafka, Redis
   ├── api/             # REST/GraphQL endpoints
   └── app/             # Запускаемый артефакт
   ```

2. **Градиент видимости**  
   Запрет прямых зависимостей между несвязанными слоями:
   ```kotlin
   // domain/build.gradle
   dependencies {
       // Запрещено: implementation(project(":api"))
       implementation(project(":infrastructure"))  # Разрешено
   }
   ```

3. **Кэширование в CI/CD**  
   Ускорение сборки в GitLab:
   ```yaml
   cache:
     key: "$CI_COMMIT_REF_SLUG"
     paths:
       - .gradle/
       - build/
       - ~/.gradle/caches/
   ```

4. **Интеграция с Spring Boot**  
   Изоляция конфигураций:
   ```kotlin
   // infrastructure/database/build.gradle
   springBoot {
       mainClass = "com.example.DatabaseApplication"
   }
   ```

5. **Мониторинг через Micrometer**  
   Сбор метрик для Grafana:
   ```kotlin
   dependencies {
       implementation("io.micrometer:micrometer-core:1.12.5")
       implementation("io.micrometer:micrometer-registry-prometheus:1.12.5")
   }
   ```

