#### [Введение](#Введение-1)
#### [Основные концепции](#Основные-концепции-1)
#### [Примеры конфигурации](#Примеры-конфигурации-1)
#### [Ошибки и решения](#Ошибки-и-решения-1)
#### [Best Practices](#best-practices-1)

---

## Введение
Создание кастомных задач в Gradle — это ключевой навык для backend-разработчиков, работающих с высоконагруженными системами. Кастомные задачи позволяют автоматизировать сложные процессы, такие как подготовка данных, миграции баз данных или интеграция с внешними системами. Без понимания этой темы невозможно эффективно управлять сборкой и развертыванием микросервисов, обрабатывающих сотни тысяч запросов в секунду.

---

## Основные концепции  
### Практическое определение
Кастомные задачи в Gradle — это пользовательские действия, которые выполняются во время сборки проекта. Они позволяют автоматизировать рутинные операции, такие как генерация кода, запуск тестов или деплой приложения. Например, в высоконагруженных системах кастомные задачи могут использоваться для подготовки данных перед запуском тестов или для очистки кэша после сборки.

### Разъяснение терминов
- **Задача (Task)** — это единица работы в Gradle, которая может выполняться во время сборки. Задачи могут зависеть друг от друга, образуя граф выполнения.
- **Кастомная задача** — это задача, созданная разработчиком для выполнения специфических действий, которые не покрываются стандартными задачами Gradle.

---

## Примеры конфигурации  
### Создание простой кастомной задачи
```kotlin
tasks.register("hello") {
    doLast {
        println("Hello, Gradle!")
    }
}
```
- **`tasks.register`** — метод для регистрации новой задачи.
- **`doLast`** — блок кода, который выполняется при запуске задачи.

### Задача с параметрами
```kotlin
tasks.register("greet") {
    val name = project.properties["name"] ?: "World"
    doLast {
        println("Hello, $name!")
    }
}
```
- **`project.properties`** — доступ к свойствам проекта, переданным через командную строку (например, `-Pname=John`).

### Задача, зависящая от другой задачи
```kotlin
tasks.register("buildAndDeploy") {
    dependsOn("build", "deploy")
    doLast {
        println("Build and deploy completed!")
    }
}
```
- **`dependsOn`** — указывает, что задача зависит от выполнения других задач (`build` и `deploy`).

---

## Ошибки и решения
### Критические антипаттерны
1. **Создание задач с побочными эффектами**:
    - **Проблема**: Задача изменяет состояние системы, что может привести к непредсказуемым результатам.
    - **Решение**: Задачи должны быть идемпотентными (повторное выполнение задачи не должно изменять результат).

2. **Игнорирование зависимостей между задачами**:
    - **Проблема**: Задачи выполняются в неправильном порядке, что приводит к ошибкам.
    - **Решение**: Всегда указывайте зависимости между задачами с помощью `dependsOn`.

3. **Использование глобальных переменных в задачах**:
    - **Проблема**: Глобальные переменные могут привести к утечкам памяти или неожиданным результатам.
    - **Решение**: Используйте локальные переменные или свойства проекта.

### Сравнение подходов
| Подход               | Плюсы                                      | Минусы                                      |
|----------------------|--------------------------------------------|--------------------------------------------|
| Кастомные задачи      | Гибкость, возможность автоматизации        | Требуют времени на разработку и тестирование |
| Стандартные задачи    | Простота, готовые решения                  | Ограниченная функциональность              |

---

## Best Practices
1. **Используйте идемпотентность**:
    - Убедитесь, что задача может быть выполнена несколько раз без изменения результата.
    - Пример:
      ```kotlin
      tasks.register("cleanCache") {
          doLast {
              delete("build/cache") // Удаление кэша
          }
      }
      ```

2. **Минимизируйте побочные эффекты**:
    - Задачи не должны изменять состояние системы за пределами своей области ответственности.
    - Пример:
      ```kotlin
      tasks.register("generateConfig") {
          doLast {
              val config = generateConfigFile() // Генерация конфигурации
              config.writeToFile("build/config.json")
          }
      }
      ```

3. **Интегрируйте задачи в CI/CD**:
    - Добавьте кастомные задачи в pipeline для автоматизации процессов.
    - Пример для GitLab CI:
      ```yaml
      stages:
        - build
      build:
        script:
          - ./gradlew buildAndDeploy
      ```

4. **Документируйте задачи**:
    - Добавляйте комментарии к задачам, чтобы другие разработчики могли понять их назначение.
    - Пример:
      ```kotlin
      tasks.register("migrateDatabase") {
          group = "Database"
          description = "Выполняет миграции базы данных."
          doLast {
              runMigrations()
          }
      }
      ```

5. **Используйте группировку задач**:
    - Группируйте задачи по функциональности для удобства навигации.
    - Пример:
      ```kotlin
      tasks.register("deployToStaging") {
          group = "Deployment"
          description = "Деплой на staging-окружение."
          doLast {
              deploy("staging")
          }
      }
      ```
